======================================================================
SCP SOLVER DEMO WITH VISUALIZATION
======================================================================

1. Loading track...
   Track length: 260.0 m

2. Creating vehicle model...
   Vehicle: SingleTrackModel(VW_Golf_GTI, weight_transfer=enabled)

3. Optimization setup:
   N = 60 points
   ds = 4.33 m
   Total distance = 260.0 m

======================================================================
STEP 1: Direct Collocation Optimizer (IPOPT)
======================================================================
Solving...

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit https://github.com/coin-or/Ipopt
******************************************************************************

This is Ipopt version 3.14.11, running with linear solver MUMPS 5.4.1.

Number of nonzeros in equality constraint Jacobian...:     6367
Number of nonzeros in inequality constraint Jacobian.:      549
Number of nonzeros in Lagrangian Hessian.............:     2833

Total number of variables............................:      610
                     variables with only lower bounds:        0
                variables with lower and upper bounds:        0
                     variables with only upper bounds:        0
Total number of equality constraints.................:      490
Total number of inequality constraints...............:      549
        inequality constraints with only lower bounds:      305
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:      244

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  2.6000000e+01 2.17e-01 6.58e-01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  2.2950739e+01 9.46e-01 3.35e+00  -1.0 4.04e+00    -  7.69e-01 1.00e+00f  1
   2  1.8420463e+01 1.86e+00 9.54e-01  -1.0 4.75e+00    -  7.55e-01 1.00e+00f  1
   3  1.3231317e+01 6.65e+00 3.64e-01  -1.0 6.41e+00    -  1.00e+00 1.00e+00f  1
   4  1.5868338e+01 1.16e+00 2.66e-01  -1.0 4.32e+00    -  1.00e+00 1.00e+00h  1
   5  1.5653503e+01 1.10e-01 1.55e-01  -1.7 8.69e-01    -  1.00e+00 1.00e+00h  1
   6  1.4965883e+01 2.82e-01 1.02e-01  -2.5 2.27e+00    -  9.53e-01 9.92e-01h  1
   7  1.4879415e+01 3.37e-02 2.71e-02  -2.5 5.68e-01    -  1.00e+00 1.00e+00h  1
   8  1.4841007e+01 1.45e-02 9.66e-03  -3.8 2.51e-01    -  1.00e+00 6.39e-01h  1
   9  1.4831972e+01 6.40e-03 5.77e-03  -3.8 1.50e-01    -  9.67e-01 9.17e-01h  1
iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
  10  1.4831862e+01 2.37e-04 1.49e-04  -3.8 2.93e-02    -  1.00e+00 1.00e+00h  1
  11  1.4830978e+01 1.21e-04 2.79e-03  -5.7 1.87e-02    -  1.00e+00 8.03e-01h  1
  12  1.4830877e+01 4.83e-05 2.28e-05  -5.7 1.31e-02    -  1.00e+00 1.00e+00h  1
  13  1.4830873e+01 5.92e-07 1.88e-07  -5.7 1.41e-03    -  1.00e+00 1.00e+00h  1
  14  1.4830862e+01 6.45e-08 2.76e-08  -7.0 4.33e-04    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 14

                                   (scaled)                 (unscaled)
Objective...............:   1.4830862052419173e+01    1.4830862052419173e+01
Dual infeasibility......:   2.7600960489371218e-08    2.7600960489371218e-08
Constraint violation....:   3.7754989239544719e-08    6.4504549257549115e-08
Variable bound violation:   0.0000000000000000e+00    0.0000000000000000e+00
Complementarity.........:   1.0474634562766406e-07    1.0474634562766406e-07
Overall NLP error.......:   1.0474634562766406e-07    1.0474634562766406e-07


Number of objective function evaluations             = 15
Number of objective gradient evaluations             = 15
Number of equality constraint evaluations            = 15
Number of inequality constraint evaluations          = 15
Number of equality constraint Jacobian evaluations   = 15
Number of inequality constraint Jacobian evaluations = 15
Number of Lagrangian Hessian evaluations             = 14
Total seconds in IPOPT                               = 1.079

EXIT: Optimal Solution Found.
      solver  :   t_proc      (avg)   t_wall      (avg)    n_eval
       nlp_f  |   1.69ms (112.93us)   1.71ms (113.75us)        15
       nlp_g  |  31.83ms (  2.12ms)  32.02ms (  2.13ms)        15
  nlp_grad_f  |   3.40ms (212.44us)   3.41ms (213.20us)        16
  nlp_hess_l  | 744.88ms ( 53.21ms) 749.07ms ( 53.50ms)        14
   nlp_jac_g  | 202.87ms ( 12.68ms) 204.02ms ( 12.75ms)        16
       total  |   1.07 s (  1.07 s)   1.08 s (  1.08 s)         1

Direct Collocation Result:
  Success: True
  Lap time: 14.8309 s
  Iterations: 14
  Solve time: 6.00 s

Generating Direct Collocation visualizations...
  Saved: /run/media/saveas/Secondary-Storage/Masters/CS234/CS234_Reinforcement_Learning/Final Project/CS234_Final_Project/results/trajectory_optimization/dc_trajectory.png
  Saved: /run/media/saveas/Secondary-Storage/Masters/CS234/CS234_Reinforcement_Learning/Final Project/CS234_Final_Project/results/trajectory_optimization/dc_states.png
  Saved: /run/media/saveas/Secondary-Storage/Masters/CS234/CS234_Reinforcement_Learning/Final Project/CS234_Final_Project/results/trajectory_optimization/dc_controls.png

======================================================================
STEP 2: SCP Solver (Cold Start) - Using IPOPT
======================================================================
Solving with cold start (no warm-start, IPOPT solver)...
SCP Solver: N=60, ds=4.333333333333333m, track length=260.0m
Initial: lap_time=26.0000s, defect=2.101501, merit=220841.2825
----------------------------------------------------------------------
  Iter 0: t=25.0000s, defect=1.760121, ||V||=4.41e-01, tr=1.400 (accepted)
  Iter 1: t=25.0000s, defect=1.760121, ||V||=2.18e-08, tr=0.700 (rejected)
  Iter 2: t=25.0000s, defect=1.760121, ||V||=4.33e-02, tr=0.350 (rejected)
  Iter 3: t=25.0000s, defect=1.760121, ||V||=2.41e-01, tr=0.175 (rejected)
  Iter 4: t=25.0000s, defect=1.760121, ||V||=3.46e-01, tr=0.087 (rejected)
  Iter 5: t=25.0000s, defect=1.760121, ||V||=4.00e-01, tr=0.044 (rejected)
  Iter 6: t=25.0438s, defect=0.980248, ||V||=4.29e-01, tr=0.061 (accepted)
  Iter 7: t=25.1050s, defect=0.667539, ||V||=3.85e-01, tr=0.086 (accepted)
  Iter 8: t=25.1050s, defect=0.667539, ||V||=3.24e-01, tr=0.043 (rejected)
  Iter 9: t=25.1479s, defect=0.394765, ||V||=3.53e-01, tr=0.060 (accepted)
  Iter 10: t=25.1479s, defect=0.394765, ||V||=3.10e-01, tr=0.030 (rejected)
  Iter 11: t=25.1779s, defect=0.340184, ||V||=3.31e-01, tr=0.042 (accepted)
  Iter 12: t=25.1779s, defect=0.340184, ||V||=3.01e-01, tr=0.021 (rejected)
  Iter 13: t=25.1989s, defect=0.318033, ||V||=3.16e-01, tr=0.029 (accepted)
  Iter 14: t=25.2283s, defect=0.301487, ||V||=2.94e-01, tr=0.041 (accepted)
  Iter 15: t=25.2695s, defect=0.294717, ||V||=2.64e-01, tr=0.058 (accepted)
  Iter 16: t=25.2695s, defect=0.294717, ||V||=2.22e-01, tr=0.029 (rejected)
  Iter 17: t=25.2983s, defect=0.253992, ||V||=2.43e-01, tr=0.040 (accepted)
  Iter 18: t=25.2983s, defect=0.253992, ||V||=2.13e-01, tr=0.020 (rejected)
  Iter 19: t=25.3185s, defect=0.231064, ||V||=2.28e-01, tr=0.028 (accepted)
  Iter 20: t=25.3467s, defect=0.221007, ||V||=2.07e-01, tr=0.040 (accepted)
  Iter 21: t=25.3467s, defect=0.221007, ||V||=1.79e-01, tr=0.020 (rejected)
  Iter 22: t=25.3665s, defect=0.196407, ||V||=1.93e-01, tr=0.028 (accepted)
  Iter 23: t=25.3942s, defect=0.185715, ||V||=1.73e-01, tr=0.039 (accepted)
  Iter 24: t=25.3942s, defect=0.185715, ||V||=1.46e-01, tr=0.019 (rejected)
  Iter 25: t=25.4136s, defect=0.163493, ||V||=1.60e-01, tr=0.027 (accepted)
  Iter 26: t=25.4407s, defect=0.156048, ||V||=1.41e-01, tr=0.038 (accepted)
  Iter 27: t=25.4787s, defect=0.151877, ||V||=1.18e-01, tr=0.053 (accepted)
  Iter 28: t=25.5319s, defect=0.151353, ||V||=8.81e-02, tr=0.074 (accepted)
  Iter 29: t=25.5319s, defect=0.151353, ||V||=5.02e-02, tr=0.037 (rejected)
  Iter 30: t=25.5691s, defect=0.075940, ||V||=6.89e-02, tr=0.052 (accepted)
  Iter 31: t=25.5691s, defect=0.075940, ||V||=4.29e-02, tr=0.026 (rejected)
  Iter 32: t=25.5951s, defect=0.062058, ||V||=5.59e-02, tr=0.036 (accepted)
  Iter 33: t=25.6316s, defect=0.058024, ||V||=3.78e-02, tr=0.051 (accepted)
  Iter 34: t=25.6827s, defect=0.047386, ||V||=1.29e-02, tr=0.071 (accepted)
----------------------------------------------------------------------
Termination: Feasibility reached: defect=4.74e-02
Final: lap_time=25.6827s, defect=0.047386, iterations=35, time=48.46s

SCP Cold Start Result:
  Success: True
  Converged: True
  Feasible: True
  Lap time: 25.6827 s
  Iterations: 35
  Solve time: 48.46 s
  Termination: Feasibility reached: defect=4.74e-02

Generating SCP cold start visualizations...
  Saved: /run/media/saveas/Secondary-Storage/Masters/CS234/CS234_Reinforcement_Learning/Final Project/CS234_Final_Project/results/trajectory_optimization/scp_cold_trajectory.png
  Saved: /run/media/saveas/Secondary-Storage/Masters/CS234/CS234_Reinforcement_Learning/Final Project/CS234_Final_Project/results/trajectory_optimization/scp_cold_states.png
  Saved: /run/media/saveas/Secondary-Storage/Masters/CS234/CS234_Reinforcement_Learning/Final Project/CS234_Final_Project/results/trajectory_optimization/scp_cold_controls.png
  Saved: /run/media/saveas/Secondary-Storage/Masters/CS234/CS234_Reinforcement_Learning/Final Project/CS234_Final_Project/results/trajectory_optimization/scp_cold_convergence.png

======================================================================
STEP 3: Comparison and Analysis
======================================================================

Generating comparison plots...
  Saved: /run/media/saveas/Secondary-Storage/Masters/CS234/CS234_Reinforcement_Learning/Final Project/CS234_Final_Project/results/trajectory_optimization/method_comparison.png

Generating trajectory animation...
  Saved: /run/media/saveas/Secondary-Storage/Masters/CS234/CS234_Reinforcement_Learning/Final Project/CS234_Final_Project/results/trajectory_optimization/trajectory_animation.gif

======================================================================
SUMMARY
======================================================================

Method                         Solver   Iters    Time [s]   Cost [s]   Success
---------------------------------------------------------------------------
Direct Collocation             IPOPT    14       6.00       14.8309    True
SCP (Cold Start)               IPOPT    35       48.46      25.6827    True

All outputs saved to: /run/media/saveas/Secondary-Storage/Masters/CS234/CS234_Reinforcement_Learning/Final Project/CS234_Final_Project/results/trajectory_optimization

Demo complete!
